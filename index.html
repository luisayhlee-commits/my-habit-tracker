<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Habit Tracker 2026</title>
    <!-- 核心套件 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'M PLUS Rounded 1c', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #020617; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes bounce-small { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-pop { animation: bounce-small 0.5s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 內建圖示組件 (解決圖示消失的問題) ---
        const SVGIcon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                droplets: <path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/>,
                footprints: <path d="M4 16v-2.3a2 2 0 1 1 2-2 2 2 0 0 1-2 2zM13 16v-2.3a2 2 0 1 1 2-2 2 2 0 0 1-2 2zM8 20v-2.3a2 2 0 1 1 2-2 2 2 0 0 1-2 2zM17 20v-2.3a2 2 0 1 1 2-2 2 2 0 0 1-2 2zM10 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM15 5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/>,
                activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>,
                moon: <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>,
                dumbbell: <path d="m6.5 6.5 11 11M3 21l3-3M18 6l3-3M3 13.5h3v-3H3zM18 13.5h3v-3h-3zM8.5 2h3v3h-3zM8.5 19h3v3h-3z"/>,
                dog: <path d="M10 5.172C10 3.782 8.423 2.679 6.5 3c-1.923.321-3.5 1.424-3.5 2.814 0 1.258 1.303 2.304 3 2.704v5.3c0 2.21 1.79 4 4 4h4a4 4 0 0 0 4-4V8.518c1.697-.4 3-1.446 3-2.704 0-1.39-1.577-2.493-3.5-2.814-1.923-.321-3.5.782-3.5 2.172v.328h-4v-.328zM12 14v.01M9 11v.01M15 11v.01"/>,
                trophy: <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-2.34M12 4v10.66M8 4h8"/>,
                plus: <path d="M12 5v14M5 12h14"/>,
                check: <path d="M20 6 9 17l-5-5"/>,
                settings: <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>,
                layout: <rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18M9 21V9"/>,
                calendar: <rect width="18" height="18" x="3" y="4" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/>,
                x: <path d="M18 6 6 18M6 6l12 12"/>,
                chevronLeft: <path d="m15 18-6-6 6-6"/>,
                chevronRight: <path d="m9 18 6-6-6-6"/>,
                sun: <circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>,
                partyPopper: <path d="M5.8 11.3 2 22l10.7-3.8M4 3h.01M9 2h.01M15 4h.01M12 9h.01M16 14h.01M10 18h.01"/>,
                download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const DEFAULT_HABITS = [
            { id: 'water', title: 'Waterllama 達標', icon: 'droplets', color: 'cyan', goalPerWeek: 5, unit: '天' },
            { id: 'steps', title: '日走 7000 步', icon: 'footprints', color: 'orange', goalPerWeek: 7, unit: '步' },
            { id: 'juc', title: '啾C 課程', icon: 'activity', color: 'pink', goalPerWeek: 3, unit: '次' },
            { id: 'stretch', title: '晚間拉筋 15min', icon: 'moon', color: 'indigo', goalPerWeek: 7, unit: '晚' },
            { id: 'weight', title: '重訓', icon: 'dumbbell', color: 'emerald', goalPerWeek: 4, unit: '次' },
            { id: 'luna', title: 'Luna 訓練', icon: 'dog', color: 'violet', goalPerWeek: 5, unit: '次' },
        ];

        const COLOR_THEMES = {
            cyan: { from: 'from-cyan-400', to: 'to-blue-500', text: 'text-cyan-500' },
            orange: { from: 'from-orange-400', to: 'to-red-500', text: 'text-orange-500' },
            pink: { from: 'from-pink-400', to: 'to-rose-500', text: 'text-pink-500' },
            indigo: { from: 'from-indigo-400', to: 'to-purple-500', text: 'text-indigo-500' },
            emerald: { from: 'from-emerald-400', to: 'to-green-500', text: 'text-emerald-500' },
            violet: { from: 'from-violet-400', to: 'to-fuchsia-500', text: 'text-violet-500' },
        };

        const getDateString = (date) => {
            const d = new Date(date);
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        };

        const getWeekStart = (date) => {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - (day === 0 ? 6 : day - 1);
            d.setDate(diff);
            d.setHours(0,0,0,0);
            return d;
        };

        function App() {
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('habit2026_logs') || '{}'));
            const [habits, setHabits] = useState(() => JSON.parse(localStorage.getItem('habit2026_list') || JSON.stringify(DEFAULT_HABITS)));
            const [currentDate, setCurrentDate] = useState(new Date());
            const [view, setView] = useState('daily');
            const [themeMode, setThemeMode] = useState('night');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [celebration, setCelebration] = useState(null);

            useEffect(() => {
                localStorage.setItem('habit2026_logs', JSON.stringify(logs));
                localStorage.setItem('habit2026_list', JSON.stringify(habits));
            }, [logs, habits]);

            const theme = themeMode === 'day' ? {
                bg: 'bg-stone-100', text: 'text-stone-800', sub: 'text-stone-500', card: 'bg-white', border: 'border-stone-200', gradient: 'from-emerald-600 to-teal-600', nav: 'bg-white/60'
            } : {
                bg: 'bg-slate-950', text: 'text-slate-100', sub: 'text-slate-400', card: 'bg-slate-800', border: 'border-slate-700', gradient: 'from-blue-400 to-purple-400', nav: 'bg-slate-900/60'
            };

            const toggleHabit = (id, dateStr) => {
                setLogs(prev => {
                    const next = { ...prev };
                    if (next[`${id}-${dateStr}`]) delete next[`${id}-${dateStr}`];
                    else {
                        next[`${id}-${dateStr}`] = true;
                        setCelebration("太棒了！");
                        setTimeout(() => setCelebration(null), 1200);
                    }
                    return next;
                });
            };

            const getWeeklyCount = (id) => {
                const start = getWeekStart(currentDate);
                let count = 0;
                for (let i = 0; i < 7; i++) {
                    const d = new Date(start);
                    d.setDate(d.getDate() + i);
                    if (logs[`${id}-${getDateString(d)}`]) count++;
                }
                return count;
            };

            const exportData = () => {
                const blob = new Blob([JSON.stringify({ logs, habits })], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `habit-backup.json`;
                a.click();
            };

            return (
                <div className={`min-h-screen ${theme.bg} ${theme.text} transition-colors duration-500`}>
                    <div className="max-w-md mx-auto min-h-screen flex flex-col relative bg-inherit shadow-2xl overflow-hidden">
                        
                        {/* Header */}
                        <div className="p-6 relative z-10">
                            <div className="flex justify-between items-center mb-8">
                                <div onClick={() => setThemeMode(themeMode === 'day' ? 'night' : 'day')} className="cursor-pointer">
                                    <h1 className={`text-2xl font-black bg-clip-text text-transparent bg-gradient-to-r ${theme.gradient}`}>Habit 2026</h1>
                                    <div className="text-[10px] font-bold opacity-40 flex items-center gap-1 uppercase tracking-widest">
                                        <SVGIcon name={themeMode === 'day' ? 'sun' : 'moon'} className="w-3 h-3" />
                                        {themeMode === 'day' ? '青山模式' : '海洋模式'}
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setIsSettingsOpen(true)} className="p-2 opacity-50 hover:opacity-100"><SVGIcon name="settings" /></button>
                                    <div className="flex bg-white/10 p-1 rounded-xl backdrop-blur-sm">
                                        <button onClick={()=>setView('daily')} className={`p-2 rounded-lg ${view==='daily'?'bg-white/20 shadow-sm':'opacity-40'}`}><SVGIcon name="layout" /></button>
                                        <button onClick={()=>setView('weekly')} className={`p-2 rounded-lg ${view==='weekly'?'bg-white/20 shadow-sm':'opacity-40'}`}><SVGIcon name="calendar" /></button>
                                    </div>
                                </div>
                            </div>

                            {/* Date Nav */}
                            <div className={`flex items-center justify-between p-3 rounded-2xl border ${theme.border} ${theme.nav} backdrop-blur-md`}>
                                <button onClick={() => { const d = new Date(currentDate); d.setDate(d.getDate()-(view==='daily'?1:7)); setCurrentDate(d); }}><SVGIcon name="chevronLeft" className="w-6 h-6 opacity-50"/></button>
                                <div className="font-bold text-sm">
                                    {view === 'daily' 
                                        ? currentDate.toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'short' }) 
                                        : `${(getWeekStart(currentDate).getMonth()+1)}月${getWeekStart(currentDate).getDate()}日 該週`}
                                </div>
                                <button onClick={() => { const d = new Date(currentDate); d.setDate(d.getDate()+(view==='daily'?1:7)); setCurrentDate(d); }}><SVGIcon name="chevronRight" className="w-6 h-6 opacity-50"/></button>
                            </div>
                        </div>

                        {/* List Area */}
                        <div className="flex-1 px-6 overflow-y-auto no-scrollbar pb-24">
                            {view === 'daily' ? (
                                habits.map(h => {
                                    const ds = getDateString(currentDate);
                                    const done = !!logs[`${h.id}-${ds}`];
                                    const c = COLOR_THEMES[h.color];
                                    return (
                                        <div 
                                            key={h.id} 
                                            onClick={() => toggleHabit(h.id, ds)}
                                            className={`p-4 rounded-2xl mb-4 border transition-all active:scale-95 cursor-pointer flex items-center justify-between ${done ? `bg-gradient-to-r ${c.from} ${c.to} border-transparent text-white shadow-lg` : `${theme.card} ${theme.border}`}`}
                                        >
                                            <div className="flex items-center gap-4">
                                                <div className={`p-3 rounded-xl ${done ? 'bg-white/20' : 'bg-black/5 dark:bg-white/5'}`}>
                                                    <SVGIcon name={h.icon} className="w-6 h-6" />
                                                </div>
                                                <div>
                                                    <div className="font-bold text-lg leading-tight">{h.title}</div>
                                                    <div className={`text-xs ${done ? 'opacity-80' : 'opacity-40'}`}>本週: {getWeeklyCount(h.id)}/{h.goalPerWeek} {h.unit}</div>
                                                </div>
                                            </div>
                                            <div className={`w-8 h-8 rounded-full border-2 flex items-center justify-center ${done ? 'bg-white border-white' : 'border-current opacity-20'}`}>
                                                {done && <SVGIcon name="check" className={`w-5 h-5 ${c.text}`} />}
                                            </div>
                                        </div>
                                    );
                                })
                            ) : (
                                <div className="overflow-x-auto">
                                    <div className="min-w-[420px]">
                                        <div className="grid grid-cols-[80px_repeat(7,1fr)] gap-2 mb-6 text-center text-xs font-bold opacity-50">
                                            <div>習慣</div>
                                            {['一','二','三','四','五','六','日'].map((l, i) => <div key={i}>{l}</div>)}
                                        </div>
                                        {habits.map(h => (
                                            <div key={h.id} className="grid grid-cols-[80px_repeat(7,1fr)] gap-2 items-center mb-5">
                                                <div className="text-xs font-bold truncate pr-2">{h.title}</div>
                                                {[0,1,2,3,4,5,6].map(i => {
                                                    const ws = getWeekStart(currentDate);
                                                    ws.setDate(ws.getDate() + i);
                                                    const ds = getDateString(ws);
                                                    const done = !!logs[`${h.id}-${ds}`];
                                                    return (
                                                        <div key={i} className="flex justify-center" onClick={() => toggleHabit(h.id, ds)}>
                                                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center transition-all ${done ? `bg-gradient-to-br ${COLOR_THEMES[h.color].from} ${COLOR_THEMES[h.color].to} text-white shadow-md` : 'bg-white/5 border border-white/10'}`}>
                                                                {done && <SVGIcon name="check" className="w-5 h-5" />}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Settings Modal */}
                        {isSettingsOpen && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm">
                                <div className={`w-full max-w-xs p-6 rounded-3xl ${theme.card} border ${theme.border} animate-pop`}>
                                    <div className="flex justify-between items-center mb-6"><h2 className="font-black text-xl">資料管理</h2><button onClick={()=>setIsSettingsOpen(false)}><SVGIcon name="x"/></button></div>
                                    <button onClick={exportData} className="w-full p-4 mb-4 rounded-2xl border border-white/10 bg-white/5 flex justify-between items-center font-bold"><span>下載備份 (.json)</span><SVGIcon name="download"/></button>
                                    <p className="text-[10px] opacity-40 leading-relaxed text-center">備註：資料存於瀏覽器緩存中。若清除快取紀錄會消失，請記得定期備份。</p>
                                </div>
                            </div>
                        )}

                        {/* Celebration */}
                        {celebration && (
                            <div className="fixed inset-0 pointer-events-none flex items-center justify-center z-[100]">
                                <div className="bg-white/95 px-8 py-4 rounded-full shadow-2xl flex items-center gap-3 animate-bounce border border-emerald-500/20">
                                    <SVGIcon name="partyPopper" className="w-8 h-8 text-yellow-500" />
                                    <span className="text-xl font-black text-slate-800">{celebration}</span>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
